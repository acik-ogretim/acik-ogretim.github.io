---
// QuizPlayer.astro
---

<!-- Settings Drawer removed (moved to Global Layout) --><!-- Premium Player Header (Fixed Bottom) -->
<header
    id="quiz-player-bar"
    class="player-bar no-print"
    style="-webkit-touch-callout: none;"
>
    <div
        class="container mx-auto flex items-center justify-between gap-1 sm:gap-4 px-1.5 sm:px-4 h-14 sm:h-16 overflow-hidden md:overflow-visible"
    >
        <!-- Left Part: Navigation & Title -->
        <div class="hidden sm:flex items-center gap-1 sm:gap-2 min-w-0">
            <div
                class="flex flex-col min-w-0 cursor-pointer p-0.5 sm:p-1 rounded-lg hover:bg-slate-700/30 transition-all"
            >
                <span
                    id="player-status-text"
                    class="block text-[8px] sm:text-[10px] md:text-xs text-slate-400 font-bold truncate"
                    >Ünite Bilgisi</span
                >
            </div>
        </div>

        <!-- Center Part: Statistics (Redesigned) -->
        <div
            id="stats-container"
            class="hidden items-center gap-1 sm:gap-2 mr-1 sm:mr-4 border-r border-slate-700/50 pr-1 sm:pr-4"
        >
            <div
                class="flex flex-col items-center justify-center bg-slate-800/80 rounded-lg px-2 sm:px-3 py-1 border border-slate-700/50"
            >
                <div
                    class="text-[10px] sm:text-lg font-black text-white leading-none"
                >
                    <span id="success-rate">0</span>%
                </div>
                <div
                    id="question-count"
                    class="text-[8px] sm:text-[9px] text-slate-500 font-bold"
                >
                    0/0
                </div>
            </div>
            <div class="flex flex-col gap-0.5 min-w-[1.5rem] sm:min-w-[3rem]">
                <div class="flex items-center justify-between gap-1">
                    <span
                        class="hidden sm:inline text-[8px] sm:text-[9px] font-bold text-slate-500"
                        >D:</span
                    >
                    <span
                        id="correct-count"
                        class="text-[9px] sm:text-xs font-black text-green-500"
                        >0</span
                    >
                </div>
                <div class="flex items-center justify-between gap-1">
                    <span
                        class="hidden sm:inline text-[8px] sm:text-[9px] font-bold text-slate-500"
                        >Y:</span
                    >
                    <span
                        id="wrong-count"
                        class="text-[9px] sm:text-xs font-black text-red-500"
                        >0</span
                    >
                </div>
            </div>
        </div>

        <!-- Right Part: Interaction Controls -->
        <div class="flex items-center gap-1 sm:gap-2 ml-auto">
            <!-- Mode Buttons -->
            <!-- Mode Buttons -->
            <div
                class="flex items-center bg-slate-800/80 p-0.5 rounded-xl border border-slate-700/50 gap-0.5 sm:gap-1"
            >
                <button
                    id="btn-toggle-reader"
                    class="player-btn-icon"
                    title="Sesli Okuma Modu"
                >
                    <span class="sr-only">Sesli Okuma Modu</span>
                    <svg
                        class="w-5 h-5 sm:w-5 sm:h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"
                        ></path>
                    </svg>
                </button>

                <button
                    id="btn-speed"
                    class="hidden md:flex items-center justify-center h-8 px-3 text-[10px] font-black text-slate-400 hover:text-teal-400 transition-colors border-l border-r border-slate-700/50"
                    >1.2x</button
                >

                <button
                    id="btn-toggle-interactive"
                    class="player-action-btn"
                    title="İnteraktif Çözüm Modu"
                >
                    <span class="btn-icon">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="14"
                            height="14"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            ><polygon points="6 3 20 12 6 21 6 3"
                            ></polygon></svg
                        >
                    </span>
                    <span class="btn-text hidden md:inline">Çöz</span>
                </button>
            </div>

            <!-- Navigation Controls -->
            <div class="flex items-center gap-0.5 sm:gap-1">
                <button id="btn-prev" class="player-btn-icon hidden xs:flex">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><polygon points="11 19 2 12 11 5 11 19"
                        ></polygon><polygon points="22 19 13 12 22 5 22 19"
                        ></polygon></svg
                    >
                </button>

                <div
                    id="speech-controls"
                    class="flex items-center bg-slate-800/80 rounded-lg border border-slate-700/50 overflow-hidden"
                >
                    <button
                        id="btn-read-question"
                        class="h-8 sm:h-9 px-1.5 sm:px-3 flex items-center gap-1.5 text-slate-400 hover:text-teal-400 hover:bg-slate-700/50 transition-all border-r border-slate-700/50"
                        title="Soruyu Oku"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            ><path
                                d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"
                            ></path><path d="M19 10v1a7 7 0 0 1-14 0v-1"
                            ></path><line x1="12" y1="19" x2="12" y2="23"
                            ></line><line x1="8" y1="23" x2="16" y2="23"
                            ></line></svg
                        >
                        <span
                            class="text-[10px] font-bold hidden sm:inline text-teal-400/80"
                            >Soru</span
                        >
                    </button>

                    <button
                        id="btn-read-explanation"
                        class="h-8 sm:h-9 px-1.5 sm:px-3 flex items-center gap-1.5 text-slate-400 hover:text-teal-400 hover:bg-slate-700/50 transition-all border-r border-slate-700/50"
                        title="Açıklamayı Oku"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            ><path d="M12 7v14"></path><path
                                d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"
                            ></path></svg
                        >
                        <span
                            class="text-[10px] font-bold hidden sm:inline text-teal-400/80"
                            >Analiz</span
                        >
                    </button>

                    <button
                        id="btn-stop-speech"
                        class="h-8 sm:h-9 w-8 sm:w-9 flex items-center justify-center text-red-500 hover:text-red-400 hover:bg-red-500/10 transition-all"
                        title="Okumayı Durdur"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            ><rect x="6" y="6" width="12" height="12"
                            ></rect></svg
                        >
                    </button>
                </div>

                <button id="btn-next" class="player-btn-icon hidden xs:flex">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><polygon points="13 19 22 12 13 5 13 19"
                        ></polygon><polygon points="2 19 11 12 2 5 2 19"
                        ></polygon></svg
                    >
                </button>
            </div>

            <!-- Meta Controls -->
            <button
                id="btn-open-settings"
                class="player-btn-icon ml-1 border border-slate-700/50"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><path
                        d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
                    ></path><circle cx="12" cy="12" r="3"></circle></svg
                >
            </button>
        </div>
    </div>

    <!-- Thin Progress Bar Top -->
    <div class="absolute top-0 left-0 right-0 h-[2px] bg-slate-800">
        <div
            id="player-progress"
            class="h-full bg-teal-500 transition-all duration-300 w-0 shadow-[0_0_8px_rgba(20,184,166,0.6)]"
        >
        </div>
    </div>
</header>

<style>
    @keyframes pulse {
        0%,
        100% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
        }
    }
    .pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    #settings-drawer.flex {
        display: flex !important;
    }
</style>

<script>
    import { QuizPlayer } from "../scripts/quiz-player.ts";

    if (typeof window !== "undefined") {
        const init = () => {
            if (!(window as any).quizPlayer) {
                (window as any).quizPlayer = new QuizPlayer();

                // Add close button listener here since it's UI specific
                const closeBtn = document.getElementById("btn-close-settings");
                const applyBtn =
                    document.getElementById("btn-apply-filters") ||
                    document.getElementById("btn-apply-settings");
                if (closeBtn)
                    closeBtn.onclick = () =>
                        (window as any).quizPlayer.toggleSettings();
                if (applyBtn)
                    applyBtn.onclick = () =>
                        (window as any).quizPlayer.toggleSettings();

                // Theme listeners
                const themeBtns = {
                    light: document.getElementById("btn-theme-light"),
                    dark: document.getElementById("btn-theme-dark"),
                    sepia: document.getElementById("btn-theme-sepia"),
                };

                Object.entries(themeBtns).forEach(([theme, btn]) => {
                    if (btn) {
                        btn.addEventListener("click", () => {
                            if ((window as any).setTheme) {
                                (window as any).setTheme(theme);
                            }
                        });
                    }
                });
            }
        };

        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", init);
        } else {
            init();
        }
    }
</script>
